<!DOCTYPE html>
<html>
<head>
	<title>Purple Air Stations - Leaflet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>
  <style>
    html,
    body {
    margin: 0;
    padding: 0;
    }
    body {
    height: 100vh;
    width: 100vw;
    }
    #mapid {
    height: 100%;
    width: 100%;
    }
</style>
</head>
<body>
    <div id="mapid" style="width: 100%; height: 100%;"></div>
    <script>
         (async () => {
             const getData = async (dataUrl) => {
                 fetchData = await fetch(dataUrl);
                 dataJSON = await fetchData.json()
                 //console.log(dataJSON);
                 return await dataJSON;
                };
            var map = L.map('mapid').setView([42, -85], 7);

            function styleFunction(feature) {
                let stationStatus = 'green';
                if (feature.properties.AQI < 50) { stationStatus = 'green';}
                else if (feature.properties.AQI < 100) { stationStatus = 'yellow';}
                else if (feature.properties.AQI < 150) { stationStatus = 'orange';}
                else if (feature.properties.AQI < 200) { stationStatus = 'red';}
                else if (feature.properties.AQI < 100) { stationStatus = 'maroon';}
                return {color: stationStatus};
            };
            const USGS_USImagery = L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}', {
	            maxZoom: 20,
	            attribution: 'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'
                }).addTo(map);
            
            const purpleAirURL = `https://purpleairwidget.firebaseapp.com/purpleAirData/44439,2822,5712,43297,7772,37659`;
            PAgeoJSON = await getData(purpleAirURL);
            console.log(PAgeoJSON);
            L.geoJSON(PAgeoJSON, {
                onEachFeature: function(feature,layer) {
                    layer.bindPopup (`<h1>${feature.properties.label} - ${feature.properties.ID}</h1>
                        <h3>PM2.5 Value:  ${feature.properties.PM2_5Value}</h3><h3>AQI:${feature.properties.AQI} </h3>
                        <ul><li>Air Quality Status:  ${feature.properties.AQIText}</li>
                        <li>24 Hour AQI:  ${feature.properties.AQI24Hour}</li>
                        <li>24 Hour Status:  ${feature.properties.AQI24HourText}</li>
                        <li>A/B Sensor Difference:  ${feature.properties.sensorDiff}</li></ul>`);
                }
            }).addTo(map);  
})();
</script>
</body>
</html>